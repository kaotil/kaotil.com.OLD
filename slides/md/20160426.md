# my aws 構成編

@kaotil

2016/04/18



## セキュアな環境を目指してawsを構成しなおしました。



# 要件
- ユーザアクセスはELBで受ける
- webサーバはprivate subnetに配置
- webサーバへのsshはbastion(踏み台)を経由
- bastionは使用するときのみ起動
- private subnetからインターネットはNATゲートウェイを経由



#### 構成図
![構成図](/slides/img/20160426/aws_design.png)<!-- .element: class="img_50" -->



# VPCのまわり作成手順



### 1. VPC作成
![VPC作成](/slides/img/20160426/aws_vpc.png)
- CIDRブロック: 10.0.0.0/24
- ルートテーブルが自動で作成される



### 2. サブネット作成
![サブネット作成](/slides/img/20160426/aws_subnet.png)
- public subnetとprivate subnetを作成
- メインのルートテーブルが割当っている



### 3. インターネットゲートウェイ作成
![インターネットゲートウェイ作成](/slides/img/20160426/aws_internet_gateway.png)
- VPCにアタッチする



### 4. NATゲートウェイ作成
![NATゲートウェイ作成](/slides/img/20160426/aws_nat_gateway.png)
- public subnetに作成する
- Elastic IPが必須



### 5. public用ルートテーブル作成
![public用ルートテーブル作成](/slides/img/20160426/aws_route_table_public.png)
- 送信先: 0:0:0:0/0、ターゲット: インターネットゲートウェイ



### 6. private用ルートテーブル作成
![private用ルートテーブル作成](/slides/img/20160426/aws_route_table_private.png)
- 送信先: 0:0:0:0/0、ターゲット: NATゲートウェイ



### 7. public用サブネットのルートを変更
![private用サブネットのルートテーブル作成](/slides/img/20160426/aws_subnet_public.png)
- public用のルートテーブルを設定



### 8. private用サブネットのルートを変更
![private用サブネットのルートテーブル作成](/slides/img/20160426/aws_subnet_private.png)
- private用のルートテーブルを設定



